  <script>
    // Multi-Step Wizard Navigation
    let currentStep = 1;
    const totalSteps = 5;
    
    function showStep(stepNumber) {
      // Hide all steps
      for (let i = 1; i <= totalSteps; i++) {
        const step = document.getElementById(`step-${i}`);
        if (step) step.style.display = 'none';
      }
      
      // Show current step
      const currentStepEl = document.getElementById(`step-${stepNumber}`);
      if (currentStepEl) currentStepEl.style.display = 'block';
      
      // Update progress indicators
      updateProgressBar(stepNumber);
      
      // Update summary if on step 5
      if (stepNumber === 5) {
        updateSummary();
      }
      
      currentStep = stepNumber;
    }
    
    function updateProgressBar(stepNumber) {
      for (let i = 1; i <= totalSteps; i++) {
        const indicator = document.getElementById(`step-indicator-${i}`);
        const progressBar = document.getElementById(`progress-bar-${i}`);
        
        if (i < stepNumber) {
          // Completed steps
          if (indicator) {
            indicator.style.background = '#059669';
            indicator.style.color = 'white';
          }
          if (progressBar) progressBar.style.width = '100%';
        } else if (i === stepNumber) {
          // Current step
          if (indicator) {
            indicator.style.background = '#0b7b6c';
            indicator.style.color = 'white';
          }
          if (progressBar) progressBar.style.width = '0%';
        } else {
          // Future steps
          if (indicator) {
            indicator.style.background = '#cbd5e1';
            indicator.style.color = '#6b7280';
          }
          if (progressBar) progressBar.style.width = '0%';
        }
      }
    }
    
    function validateStep(stepNumber) {
      if (stepNumber === 1) {
        const firstName = document.getElementById('first-name').value.trim();
        const gender = document.querySelector('input[name="gender"]:checked');
        if (!firstName) {
          alert('Bitte geben Sie Ihren Vornamen ein.');
          return false;
        }
        if (!gender) {
          alert('Bitte wählen Sie Ihr Geschlecht aus.');
          return false;
        }
        return true;
      }
      
      if (stepNumber === 2) {
        const age = document.getElementById('age').value;
        const weight = document.getElementById('weight').value;
        const height = document.getElementById('height').value;
        
        if (!age || age < 18 || age > 120) {
          alert('Bitte geben Sie ein gültiges Alter ein (18-120 Jahre).');
          return false;
        }
        if (!weight || weight < 30 || weight > 250) {
          alert('Bitte geben Sie ein gültiges Gewicht ein (30-250 kg).');
          return false;
        }
        if (!height || height < 120 || height > 230) {
          alert('Bitte geben Sie eine gültige Größe ein (120-230 cm).');
          return false;
        }
        return true;
      }
      
      if (stepNumber === 3) {
        const medicationInputs = document.querySelectorAll('input[name="medication_name[]"]');
        let hasValidMedication = false;
        
        medicationInputs.forEach(input => {
          if (input.value.trim()) {
            hasValidMedication = true;
          }
        });
        
        if (!hasValidMedication) {
          alert('Bitte geben Sie mindestens ein Medikament ein.');
          return false;
        }
        return true;
      }
      
      if (stepNumber === 4) {
        const duration = document.getElementById('duration-weeks').value;
        
        if (!duration) {
          alert('Bitte wählen Sie eine Plan-Dauer aus.');
          return false;
        }
        return true;
      }
      
      if (stepNumber === 5) {
        const email = document.getElementById('email').value.trim();
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        
        if (!email || !emailRegex.test(email)) {
          alert('Bitte geben Sie eine gültige E-Mail-Adresse ein.');
          return false;
        }
        return true;
      }
      
      return true;
    }
    
    function updateSummary() {
      // Name
      const firstName = document.getElementById('first-name').value.trim();
      document.getElementById('summary-name').textContent = firstName || '-';
      
      // Gender
      const genderInput = document.querySelector('input[name="gender"]:checked');
      const genderText = genderInput ? (genderInput.value === 'female' ? 'Weiblich' : genderInput.value === 'male' ? 'Männlich' : 'Divers') : '-';
      document.getElementById('summary-gender').textContent = genderText;
      
      // Age, Weight, Height
      document.getElementById('summary-age').textContent = document.getElementById('age').value + ' Jahre' || '-';
      document.getElementById('summary-weight').textContent = document.getElementById('weight').value + ' kg' || '-';
      document.getElementById('summary-height').textContent = document.getElementById('height').value + ' cm' || '-';
      
      // Medications
      const medicationInputs = document.querySelectorAll('input[name="medication_name[]"]');
      const medications = [];
      medicationInputs.forEach(input => {
        if (input.value.trim()) {
          medications.push(input.value.trim());
        }
      });
      document.getElementById('summary-medications').textContent = medications.length > 0 ? medications.join(', ') : '-';
      
      // Duration
      const durationSelect = document.getElementById('duration-weeks');
      const durationText = durationSelect.options[durationSelect.selectedIndex]?.text || '-';
      document.getElementById('summary-duration').textContent = durationText;
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Next buttons
      document.querySelectorAll('.next-step').forEach(button => {
        button.addEventListener('click', function() {
          if (validateStep(currentStep)) {
            if (currentStep < totalSteps) {
              showStep(currentStep + 1);
            }
          }
        });
      });
      
      // Previous buttons
      document.querySelectorAll('.prev-step').forEach(button => {
        button.addEventListener('click', function() {
          if (currentStep > 1) {
            showStep(currentStep - 1);
          }
        });
      });
      
      // Initialize: Show step 1
      showStep(1);
      
      // Add medication functionality
      const medList = document.getElementById('medication-inputs');
      const btnAddMed = document.getElementById('add-medication');

      function addMedRow() {
        const wrapper = document.createElement('div');
        wrapper.className = 'med-row';
        wrapper.style.marginBottom = '0.8rem';

        wrapper.innerHTML = `
          <input type="text" name="medication_name[]" placeholder="Name des Medikaments" style="margin-bottom: 0.4rem;" />
          <input type="text" name="medication_dosage[]" placeholder="z. B. 10 mg morgens, 10 mg abends" style="margin-bottom: 0.4rem;" />
          <button type="button" class="btn-small btn-remove-med">Entfernen</button>
        `;

        medList.appendChild(wrapper);

        wrapper.querySelector('.btn-remove-med').addEventListener('click', () => {
          medList.removeChild(wrapper);
        });
      }

      if (btnAddMed) {
        btnAddMed.addEventListener('click', addMedRow);
        // mindestens eine Zeile beim Start
        addMedRow();
      }
      
      // Form submission
      const form = document.getElementById('medication-form');
      if (form) {
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          alert('Hier wird später die API-Anbindung implementiert.\n\nAktuell ist dies nur die Demo-Oberfläche.');
        });
      }
    });
  </script>
